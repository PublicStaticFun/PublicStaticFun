name: Update Experience Years

on:
  schedule:
    - cron: '0 0 30 10 *'  # Ejecuta cada 30 de octubre a las 00:00 UTC
  workflow_dispatch:  # Permite ejecutarlo manualmente desde GitHub Actions

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install dependencies
        run: npm install date-fns

      - name: Update README with current years
        run: |
          node <<'EOF'
          const { differenceInYears } = require('date-fns');
          const fs = require('fs');

          // Fechas reales de inicio
          const startDates = {
            'React': new Date('2022-10-30'),
            'PostgreSQL': new Date('2021-10-30'),
            'Django': new Date('2020-10-30')
          };

          let readme = fs.readFileSync('README.md', 'utf8');

          Object.keys(startDates).forEach(skill => {
            const years = differenceInYears(new Date(), startDates[skill]);
            readme = readme.replace(new RegExp(`\\[${skill}-Years\\]`, 'g'), years);
          });

          fs.writeFileSync('README.md', readme);
          EOF

      - name: Commit and push changes
        run: |
          git config --local user.email 'action@github.com'
          git config --local user.name 'GitHub Action'
          git add README.md
          git commit -m "Update experience years automatically" || echo "No changes to commit"
          git push
